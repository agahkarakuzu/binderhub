

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Debugging BinderHub &#8212; BinderHub 0.1.0 documentation</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="https://gitcdn.link/repo/jupyterhub/binder/master/doc/_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link href="_static/css/index.css" rel="stylesheet">
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script type="text/javascript" src="_static/copybutton.js"></script>
    <link rel="shortcut icon" href="_static/favicon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Customizing your BinderHub deployment" href="customizing.html" />
    <link rel="prev" title="Customization" href="customization/index.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">

<a class="navbar-brand" href="index.html">
  <img src="_static/logo.png" class="logo" alt="logo">
</a>

<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
</button>

<div id="navbar-menu" class="collapse navbar-collapse">
  <ul id="navbar-main-elements" class="navbar-nav mr-auto">
    <li class="nav-item">
        <a class="nav-link" href="index.html">Home</a>
    </li>
    
    
    <li class="nav-item ">
        <a class="nav-link" href="zero-to-binderhub/index.html">Zero to BinderHub</a>
    </li>
    
    <li class="nav-item active">
        <a class="nav-link" href="customization/index.html">Customization</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="developer/index.html">Administrators and developers</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="community/index.html">Community</a>
    </li>
    
    
  </ul>
  <ul class="navbar-nav ml-auto">
    
    
  </ul>
</div>
    </nav>
    

    <div class="container-fluid">
      <div class="row">
          
          <div class="col-12 col-md-3 col-xl-2 bd-sidebar">

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">
  

  <ul class="nav bd-sidenav">
      
      
      
      
        
          
              <li class="active">
                  <a href="">Debugging BinderHub</a>
              </li>
          
        
          
              <li class="">
                  <a href="customizing.html">Customizing your BinderHub deployment</a>
              </li>
          
        
          
              <li class="">
                  <a href="authentication.html">Enabling Authentication</a>
              </li>
          
        
          
              <li class="">
                  <a href="https.html">Secure with HTTPS</a>
              </li>
          
        
      
      
      
      
      
      
    </ul>

</nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              


<div class="tocsection onthispage"><i class="fas fa-list"></i> On this page</div>
<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#indentation-in-config-files" class="nav-link">Indentation in Config Files</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#changing-the-helm-chart" class="nav-link">Changing the helm chart</a>
        </li>
    
    </ul>
</nav>
              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content" role="main">
              
              <div>
                
  <div class="section" id="debugging-binderhub">
<h1>Debugging BinderHub<a class="headerlink" href="#debugging-binderhub" title="Permalink to this headline">¶</a></h1>
<p>If BinderHub isn’t behaving as you’d expect, you’ll need to debug your
kubernetes deployment of the JupyterHub and BinderHub services. For a
guide on how to debug in Kubernetes, see the <a class="reference external" href="https://zero-to-jupyterhub.readthedocs.io/en/latest/debug.html">Zero to JupyterHub debugging
guide</a>.</p>
<div class="section" id="indentation-in-config-files">
<h2>Indentation in Config Files<a class="headerlink" href="#indentation-in-config-files" title="Permalink to this headline">¶</a></h2>
<p>Probably the most common cause of unexplained behaviour from a BinderHub is an incorrectly indented key in one of the configuration files.
Indentation levels can change depending on how the BinderHub was deployed.
Or in other words, the structure of the values is dictated by the chart being configured.</p>
<p>If you deployed BinderHub by following <a class="reference external" href="https://binderhub.readthedocs.io/en/latest/index.html#zero-to-binderhub">Zero to BinderHub</a>, then you probably have <code class="docutils literal notranslate"><span class="pre">secret.yaml</span></code> and <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> files.
This is the case where one chart includes another.
Here, the BinderHub chart includes the JupyterHub chart.
The included chart values are loaded from a key with the chart’s name, within the parent <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> file.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># BinderHub chart config is top-level</span>
<span class="n">registry</span><span class="p">:</span>
  <span class="n">username</span><span class="p">:</span> <span class="s2">&quot;a-username&quot;</span>
  <span class="n">password</span><span class="p">:</span> <span class="s2">&quot;xxxx&quot;</span>

<span class="c1"># JupyterHub chart config is now under &quot;jupyterhub&quot; key</span>
<span class="c1"># This key is dictated by the name of the included chart</span>
<span class="n">jupyterhub</span><span class="p">:</span>
  <span class="n">hub</span><span class="p">:</span>
    <span class="n">resources</span><span class="p">:</span>
      <span class="n">memory</span><span class="p">:</span>
        <span class="n">limit</span><span class="p">:</span> <span class="s1">&#39;1G&#39;</span>
</pre></div>
</div>
<p>If you were deploying only a JupyterHub, it only has one chart and so many of the Hub-related keys become top-level, such as “hub”, “singleuser”, “auth” and so on.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">auth</span><span class="p">:</span>
  <span class="nb">type</span><span class="p">:</span> <span class="s2">&quot;github&quot;</span>

<span class="n">hub</span><span class="p">:</span>
  <span class="n">resources</span><span class="p">:</span>
    <span class="n">memory</span><span class="p">:</span>
      <span class="n">limit</span><span class="p">:</span> <span class="s2">&quot;1G&quot;</span>
</pre></div>
</div>
<p>If you are using the <a class="reference external" href="https://zero-to-jupyterhub.readthedocs.io/en/latest/#customization-guide">JupyterHub for Kubernetes Customization Guide</a>, then this is an important difference to note.
Any keys you add <strong>to the BinderHub</strong> from this guide, should go under the <code class="docutils literal notranslate"><span class="pre">jupyterhub</span></code> key in <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> file as they are specific to the JupyterHub chart included within BinderHub.</p>
<p>For completeness, another case is how <a class="reference external" href="https://github.com/jupyterhub/mybinder.org-deploy">mybinder.org</a> itself is deployed.
The BinderHub serving mybinder.org is deployed as a dependency of a local chart and so <code class="docutils literal notranslate"><span class="pre">binderhub</span></code> <a class="reference external" href="https://github.com/jupyterhub/mybinder.org-deploy/blob/b34c7980caddb4e422136bf3e1d95c25cabcc078/mybinder/values.yaml#L24">becomes the top-level key</a> with <code class="docutils literal notranslate"><span class="pre">jupyterhub</span></code> nested below.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">binderhub</span><span class="p">:</span>
  <span class="n">registry</span><span class="p">:</span>
    <span class="o">...</span>

  <span class="n">jupyterhub</span><span class="p">:</span>
    <span class="n">hub</span><span class="p">:</span>
      <span class="o">...</span>
</pre></div>
</div>
<p>Such kinds of “nested” chart dependencies are managed by a special file called <code class="docutils literal notranslate"><span class="pre">requirements.yaml</span></code>.
More info on using such a file can be found in the <a class="reference external" href="https://helm.sh/docs/developing_charts/#managing-dependencies-with-requirements-yaml">related Helm docs</a>.</p>
<p>Ok so now that we’ve ascertained that indentation errors are the most likely cause of undesirable behaviour, how can we prevent them?</p>
<p>One tool that can be used to combat this is <a class="reference external" href="https://github.com/databus23/helm-diff">helm diff</a> which shows what would change in the chart between upgrades, releases, etc.
If you think something should change but the diff is empty, that’s probably a good clue something is misplaced!</p>
<p>An automated script to check linting may also be of appeal.
The Jupyter Team have a <a class="reference external" href="https://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/eaf87a217fca1834e299a0567a1ef87d813369b7/tools/templates/lint-and-validate.py">lint script</a> to check the validity of the JupyterHub chart.
It runs <code class="docutils literal notranslate"><span class="pre">yamllint</span></code>, <code class="docutils literal notranslate"><span class="pre">helm</span> <span class="pre">lint</span></code> and <code class="docutils literal notranslate"><span class="pre">kubeval</span></code>.</p>
<p>For further discussion on this topic or to join the conversation, you can visit <a class="reference external" href="https://discourse.jupyter.org/t/nesting-levels-in-config-yml-file/1037">this Discourse thread</a> or <a class="reference external" href="https://github.com/jupyterhub/binderhub/issues/845">this GitHub issue</a>.</p>
</div>
<div class="section" id="changing-the-helm-chart">
<h2>Changing the helm chart<a class="headerlink" href="#changing-the-helm-chart" title="Permalink to this headline">¶</a></h2>
<p>If you make changes to your Helm Chart (e.g., while debugging), you should
run an upgrade on your Kubernetes deployment like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">helm</span> <span class="n">upgrade</span> <span class="n">binder</span> <span class="n">jupyterhub</span><span class="o">/</span><span class="n">binderhub</span> <span class="o">--</span><span class="n">version</span><span class="o">=&lt;</span><span class="n">commit</span><span class="o">-</span><span class="nb">hash</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">f</span> <span class="n">secret</span><span class="o">.</span><span class="n">yaml</span> <span class="o">-</span><span class="n">f</span> <span class="n">config</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;commit-hash&gt;</span></code> can be found <a class="reference external" href="https://jupyterhub.github.io/helm-chart/#development-releases-binderhub">here</a>.</p>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="customization/index.html" title="previous page">Customization</a>
    <a class='right-next' id="next-link" href="customizing.html" title="next page">Customizing your BinderHub deployment</a>

              </div>
              
          </main>
          

      </div>
    </div>

    <script src="_static/js/index.js"></script>
    <footer class="footer">
  <div class="container">
    <p>
          &copy; Copyright 2017, The Jupyter Team.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>